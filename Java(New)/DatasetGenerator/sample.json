[
    {
        "language": "Java",
        "vulnerability": "Insecure Deserialization",
        "status": "vulnerable",
        "code": "public class DeviceManagementSystem {\n    private static final String SERVER_ADDRESS = \"localhost\";\n    private static final int SERVER_PORT = 8080;\n    public void handleFirmwareUpdate(String serializedFirmwareObject) {\n        try (Socket socket = new Socket(SERVER_ADDRESS, SERVER_PORT);\n             OutputStream outputStream = socket.getOutputStream()) {\n            ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(serializedFirmwareObject.getBytes()));\n            FirmwareUpdate firmwareUpdate = (FirmwareUpdate) ois.readObject();\n            processFirmwareUpdate(firmwareUpdate);\n        } catch (IOException | ClassNotFoundException e) {\n            e.printStackTrace();\n        }\n    }\n    private void processFirmwareUpdate(FirmwareUpdate firmwareUpdate) {\n        System.out.println(\"Updating firmware to version: \" + firmwareUpdate.getVersion());\n    }\n    public static void main(String[] args) {\n        DeviceManagementSystem dms = new DeviceManagementSystem();\n        String maliciousSerializedFirmware = \"\\\"java.io.BufferedReader\\\"\"; \n        dms.handleFirmwareUpdate(maliciousSerializedFirmware);\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Insecure Deserialization",
        "status": "benign",
        "code": "class PatientRecordManager implements Serializable {\n    private static final long serialVersionUID = 1L;\n    private String patientName;\n    private int patientId;\n    private transient Map<String, List<String>> medicalRecords;\n    public PatientRecordManager(String patientName, int patientId) {\n        this.patientName = patientName;\n        this.patientId = patientId;\n        this.medicalRecords = new HashMap<>();\n    }\n    public void addMedicalRecord(String recordType, String details) {\n        medicalRecords.computeIfAbsent(recordType, k -> new ArrayList<>()).add(details);\n    }\n    public List<String> getMedicalRecords(String recordType) {\n        return medicalRecords.getOrDefault(recordType, Collections.emptyList());\n    }\n    public void serializeToFile(String filename) throws IOException {\n        try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(filename))) {\n            oos.writeObject(this);\n        }\n    }\n    public static PatientRecordManager deserializeFromFile(String filename) throws IOException, ClassNotFoundException {\n        try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(filename))) {\n            return (PatientRecordManager) ois.readObject();\n        }\n    }\n    public static void main(String[] args) {\n        try {\n            PatientRecordManager manager = new PatientRecordManager(\"John Doe\", 12345);\n            manager.addMedicalRecord(\"Diagnosis\", \"Flu\");\n            manager.serializeToFile(\"patient_record.ser\");\n            PatientRecordManager deserializedManager = deserializeFromFile(\"patient_record.ser\");\n            System.out.println(deserializedManager.getMedicalRecords(\"Diagnosis\"));\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "SQL Injection",
        "status": "vulnerable",
        "code": "public class EmployeeOnboardingService {\n    private static final String DB_URL = \"jdbc:mysql:\n    private static final String USER = \"admin\";\n    private static final String PASS = \"password\";\n    public void onboardEmployee(String employeeName, int departmentId) {\n        Connection conn = null;\n        Statement stmt = null;\n        try {\n            conn = DriverManager.getConnection(DB_URL, USER, PASS);\n            stmt = conn.createStatement();\n            String sql = \"INSERT INTO employees (name, department_id) VALUES ('\" + employeeName + \"', \" + departmentId + \")\";\n            stmt.executeUpdate(sql);\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            try {\n                if (stmt != null) stmt.close();\n                if (conn != null) conn.close();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n    }\n    public ResultSet getEmployeeDetails(String employeeName) {\n        Connection conn = null;\n        Statement stmt = null;\n        try {\n            conn = DriverManager.getConnection(DB_URL, USER, PASS);\n            stmt = conn.createStatement();\n            String sql = \"SELECT * FROM employees WHERE name = '\" + employeeName + \"'\";\n            return stmt.executeQuery(sql);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return null;\n        }\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "SQL Injection",
        "status": "benign",
        "code": "public class TaxRecordService {\n    private final DataSource dataSource;\n    public TaxRecordService(DataSource dataSource) {\n        this.dataSource = dataSource;\n    }\n    public void updateTaxpayerDetails(String taxpayerId, String newEmail) throws SQLException {\n        if (!isValidEmail(newEmail)) {\n            throw new IllegalArgumentException(\"Invalid email address\");\n        }\n        String sql = \"UPDATE Taxpayer SET Email = ? WHERE TaxpayerId = ?\";\n        try (Connection connection = dataSource.getConnection();\n             PreparedStatement preparedStatement = connection.prepareStatement(sql)) {\n            preparedStatement.setString(1, newEmail);\n            preparedStatement.setString(2, taxpayerId);\n            preparedStatement.executeUpdate();\n        }\n    }\n    private boolean isValidEmail(String email) {\n        String emailRegex = \"^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\\\.[a-zA-Z0-9-.]+$\";\n        return email != null && email.matches(emailRegex);\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Log Injection",
        "status": "vulnerable",
        "code": "public class EmployeeOnboardingService {\n    private static final Logger logger = Logger.getLogger(EmployeeOnboardingService.class.getName());\n    public void onboardEmployee(String username, String logMessage) {\n        logger.info(\"User \" + username + \": \" + logMessage);\n    }\n    public static void main(String[] args) {\n        EmployeeOnboardingService service = new EmployeeOnboardingService();\n        String maliciousInput = \"maliciousUser; System.exit(1);\";\n        service.onboardEmployee(\"admin\", maliciousInput);\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Log Injection",
        "status": "benign",
        "code": "public class UserActivityLogger {\n    private static final Logger logger = Logger.getLogger(UserActivityLogger.class.getName());\n    public void logUserAction(String userId, String action) {\n        if (userId == null || action == null) {\n            throw new IllegalArgumentException(\"User ID and action cannot be null\");\n        }\n        String sanitizedUserId = StringEscapeUtils.escapeJava(userId);\n        String sanitizedAction = StringEscapeUtils.escapeJava(action);\n        logger.info(\"User ID: \" + sanitizedUserId + \" performed action: \" + sanitizedAction);\n    }\n    public void logUserLogin(String username, String ipAddress) {\n        if (username == null || ipAddress == null) {\n            throw new IllegalArgumentException(\"Username and IP address cannot be null\");\n        }\n        String sanitizedUsername = StringEscapeUtils.escapeJava(username);\n        String sanitizedIpAddress = StringEscapeUtils.escapeJava(ipAddress);\n        logger.info(\"User \" + sanitizedUsername + \" logged in from IP: \" + sanitizedIpAddress);\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "TOCTOU (Time-of-check to Time-of-use)",
        "status": "vulnerable",
        "code": "public class IoTDeviceFirmwareUpdater {\n    private static final String FIRMWARE_DIRECTORY = \"/opt/firmware/\";\n    public void updateFirmware(String firmwareFileName) throws IOException {\n        File firmwareFile = new File(FIRMWARE_DIRECTORY + firmwareFileName);\n        if (firmwareFile.exists() && !firmwareFile.isDirectory()) {\n            FileInputStream fis = null;\n            try {\n                fis = new FileInputStream(firmwareFile);\n                byte[] buffer = new byte[1024];\n                while (fis.read(buffer) != -1) {\n                }\n            } finally {\n                if (fis != null) {\n                    fis.close();\n                }\n            }\n        } else {\n            throw new IOException(\"Firmware file does not exist or is a directory.\");\n        }\n    }\n    public static void main(String[] args) {\n        IoTDeviceFirmwareUpdater updater = new IoTDeviceFirmwareUpdater();\n        try {\n            updater.updateFirmware(\"device_firmware.bin\");\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "TOCTOU (Time-of-check to Time-of-use)",
        "status": "benign",
        "code": "public class InventoryManager {\n    private static final String INVENTORY_ROOT = \"/var/inventory/\";\n    public boolean processOrder(String productId, int quantity) {\n        File productFile = new File(INVENTORY_ROOT + productId);\n        if (!productFile.exists()) {\n            return false;\n        }\n        try {\n            Thread.sleep(1000); \n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n            return false;\n        }\n        if (!productFile.exists()) {\n            return false;\n        }\n        Path path = Paths.get(productFile.getAbsolutePath());\n        try {\n            String content = new String(Files.readAllBytes(path));\n            int currentStock = Integer.parseInt(content.trim());\n            if (currentStock < quantity) {\n                return false;\n            }\n            Files.write(path, String.valueOf(currentStock - quantity).getBytes());\n        } catch (Exception e) {\n            return false;\n        }\n        return true;\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Path Traversal",
        "status": "vulnerable",
        "code": "public class AccountDownloadServlet extends HttpServlet {\n    private static final long serialVersionUID = 1L;\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n        String filePath = request.getParameter(\"filePath\");\n        File file = new File(filePath);\n        if (file.exists() && !file.isDirectory()) {\n            try (FileInputStream fis = new FileInputStream(file)) {\n                response.setContentType(\"application/octet-stream\");\n                byte[] buffer = new byte[4096];\n                int bytesRead;\n                while ((bytesRead = fis.read(buffer)) != -1) {\n                    response.getOutputStream().write(buffer, 0, bytesRead);\n                }\n            }\n        } else {\n            response.sendError(HttpServletResponse.SC_NOT_FOUND, \"File not found\");\n        }\n    }\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n        doGet(request, response);\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Path Traversal",
        "status": "benign",
        "code": "public class InventoryFileHandler {\n    private static final String INVENTORY_ROOT_DIR = \"/secure/inventory/files/\";\n    public void processFile(String fileName) {\n        if (fileName == null || !isValidFileName(fileName)) {\n            throw new IllegalArgumentException(\"Invalid file name\");\n        }\n        Path filePath = Paths.get(INVENTORY_ROOT_DIR, fileName).toAbsolutePath().normalize();\n        if (!filePath.startsWith(INVENTORY_ROOT_DIR)) {\n            throw new SecurityException(\"Attempted Path Traversal\");\n        }\n        try {\n            if (Files.exists(filePath)) {\n                System.out.println(\"Processing file: \" + filePath);\n            } else {\n                System.out.println(\"File does not exist: \" + filePath);\n            }\n        } catch (Exception e) {\n            System.err.println(\"Error processing file: \" + filePath);\n            throw new RuntimeException(e);\n        }\n    }\n    private boolean isValidFileName(String fileName) {\n        return fileName != null && !fileName.contains(\"..\") && !fileName.startsWith(\"/\") && !fileName.endsWith(\"/\");\n    }\n    public static void main(String[] args) {\n        InventoryFileHandler handler = new InventoryFileHandler();\n        try {\n            handler.processFile(\"validFileName.txt\");\n        } catch (Exception e) {\n            System.err.println(e.getMessage());\n        }\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Broken Access Control",
        "status": "vulnerable",
        "code": "public class UserProfileServlet extends HttpServlet {\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {\n        String userId = request.getParameter(\"userId\");\n        User user = fetchUser(userId);\n        if (user != null) {\n            response.getWriter().write(\"Full Name: \" + user.getFullName());\n            response.getWriter().write(\"Email: \" + user.getEmail());\n        } else {\n            response.sendError(HttpServletResponse.SC_NOT_FOUND, \"User not found\");\n        }\n    }\n    private User fetchUser(String userId) {\n        return new User(userId, \"John Doe\", \"john.doe@example.com\");\n    }\n    static class User {\n        private String id;\n        private String fullName;\n        private String email;\n        public User(String id, String fullName, String email) {\n            this.id = id;\n            this.fullName = fullName;\n            this.email = email;\n        }\n        public String getId() {\n            return id;\n        }\n        public String getFullName() {\n            return fullName;\n        }\n        public String getEmail() {\n            return email;\n        }\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Broken Access Control",
        "status": "benign",
        "code": "public class PatientRecordService {\n    private final PatientRepository patientRepository;\n    private final UserSessionManager userSessionManager;\n    public PatientRecordService(PatientRepository patientRepository, UserSessionManager userSessionManager) {\n        this.patientRepository = patientRepository;\n        this.userSessionManager = userSessionManager;\n    }\n    public void viewPatientRecord(HttpServletRequest request, HttpServletResponse response) {\n        String patientId = request.getParameter(\"patientId\");\n        String userId = userSessionManager.getAuthenticatedUserId(request);\n        if (userId == null) {\n            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n            return;\n        }\n        Patient patient = patientRepository.findById(patientId);\n        if (patient == null) {\n            response.setStatus(HttpServletResponse.SC_NOT_FOUND);\n            return;\n        }\n        if (!canAccessPatientRecord(userId, patient)) {\n            response.setStatus(HttpServletResponse.SC_FORBIDDEN);\n            return;\n        }\n        response.setStatus(HttpServletResponse.SC_OK);\n    }\n    private boolean canAccessPatientRecord(String userId, Patient patient) {\n        return patient.getOwnerId().equals(userId) || userSessionManager.hasRole(userId, \"ADMIN\");\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Open Redirect",
        "status": "vulnerable",
        "code": "public class FirmwareUpdateServlet extends HttpServlet {\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {\n        String redirectUrl = request.getParameter(\"redirect\");\n        response.sendRedirect(redirectUrl);\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Open Redirect",
        "status": "benign",
        "code": "public class RedirectServlet extends HttpServlet {\n    private static final long serialVersionUID = 1L;\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n        String redirectUrl = request.getParameter(\"url\");\n        if (isValidRedirectUrl(redirectUrl)) {\n            response.sendRedirect(redirectUrl);\n        } else {\n            response.sendError(HttpServletResponse.SC_FORBIDDEN, \"Invalid redirect URL\");\n        }\n    }\n    private boolean isValidRedirectUrl(String url) {\n        if (url == null || url.isEmpty()) {\n            return false;\n        }\n        String allowedDomain = \"https:\n        URI uri;\n        try {\n            uri = new URI(url);\n            return allowedDomain.equals(uri.toString());\n        } catch (Exception e) {\n            return false;\n        }\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "XXE (XML External Entity)",
        "status": "vulnerable",
        "code": "public class ShipmentTracker {\n    public void processShipment(String shipmentDetails) {\n        try {\n            DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();\n            DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();\n            StringReader sr = new StringReader(shipmentDetails);\n            InputSource is = new InputSource(sr);\n            Document doc = dBuilder.parse(is);\n            doc.getDocumentElement().normalize();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n    public static void main(String[] args) {\n        ShipmentTracker tracker = new ShipmentTracker();\n        Scanner scanner = new Scanner(System.in);\n        System.out.println(\"Enter shipment details in XML format:\");\n        String input = scanner.nextLine();\n        tracker.processShipment(input);\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "XXE (XML External Entity)",
        "status": "benign",
        "code": "public class TaxFormProcessor {\n    public void processTaxForm(File taxFormData) throws Exception {\n        DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();\n        dbFactory.setFeature(\"http:\n        dbFactory.setFeature(\"http:\n        dbFactory.setFeature(\"http:\n        dbFactory.setXIncludeAware(false);\n        dbFactory.setExpandEntityReferences(false);\n        DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();\n        Document doc = dBuilder.parse(taxFormData);\n        doc.getDocumentElement().normalize();\n        NodeList citizenDataNodes = doc.getElementsByTagName(\"CitizenData\");\n        for (int i = 0; i < citizenDataNodes.getLength(); i++) {\n            Node node = citizenDataNodes.item(i);\n            if (node.getNodeType() == Node.ELEMENT_NODE) {\n                Element elem = (Element) node;\n                String name = elem.getElementsByTagName(\"Name\").item(0).getTextContent();\n                String ssn = elem.getElementsByTagName(\"SSN\").item(0).getTextContent();\n                processCitizenData(name, ssn);\n            }\n        }\n    }\n    private void processCitizenData(String name, String ssn) {\n        System.out.println(\"Processing data for: \" + name + \", SSN: \" + ssn);\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Command Injection",
        "status": "vulnerable",
        "code": "public class DeviceControlServlet {\n    public void handleRequest(HttpServletRequest request, HttpServletResponse response) throws IOException {\n        String deviceId = request.getParameter(\"deviceId\");\n        String command = \"sudo ./control_device.sh \" + deviceId;\n        ProcessBuilder processBuilder = new ProcessBuilder(command.split(\" \"));\n        Map<String, String> env = processBuilder.environment();\n        env.put(\"PATH\", \"/usr/local/bin:/usr/bin:/bin\");\n        processBuilder.redirectErrorStream(true);\n        Process process = processBuilder.start();\n        int exitCode = process.waitFor();\n        if (exitCode == 0) {\n            response.getWriter().write(\"Device control command executed successfully.\");\n        } else {\n            response.getWriter().write(\"Error executing device control command.\");\n        }\n    }\n}"
    },
    {
        "language": "Java",
        "vulnerability": "Command Injection",
        "status": "benign",
        "code": "public class LicenseManagementSystem {\n    public static void main(String[] args) {\n        Scanner scanner = new Scanner(System.in);\n        System.out.println(\"Enter the license key to validate:\");\n        String licenseKey = scanner.nextLine();\n        boolean isValidLicense = validateLicense(licenseKey);\n        if (isValidLicense) {\n            System.out.println(\"License is valid. Proceeding with further actions.\");\n        } else {\n            System.err.println(\"Invalid license key.\");\n        }\n        scanner.close();\n    }\n    private static boolean validateLicense(String licenseKey) {\n        if (licenseKey == null || licenseKey.isEmpty()) {\n            return false;\n        }\n        try {\n            ProcessBuilder processBuilder = new ProcessBuilder(\"license_validator\", \"--key\", licenseKey);\n            processBuilder.redirectErrorStream(true);\n            Process process = processBuilder.start();\n            int exitCode = process.waitFor();\n            return exitCode == 0;\n        } catch (IOException | InterruptedException e) {\n            System.err.println(\"An error occurred while validating the license.\");\n            return false;\n        }\n    }\n}"
    }
]